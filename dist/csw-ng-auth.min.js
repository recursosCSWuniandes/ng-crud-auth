/*! csw-ng-auth 2016-07-26 */
!function(a){var b=a.module("authModule",["ui.router","checklist-model","ngMessages","ui.bootstrap"]);b.config(["$stateProvider","authServiceProvider",function(a,b){var c=b.getValues();a.state(c.loginState,{url:"/login",views:{mainView:{templateUrl:"src/templates/login.html",controller:"authController",controllerAs:"authCtrl"}}}),a.state(c.registerState,{url:"/register",views:{mainView:{templateUrl:"src/templates/register.html",controller:"authController",controllerAs:"authCtrl"}}}),a.state(c.forgotPassState,{url:"/forgot",views:{mainView:{templateUrl:"src/templates/forgotPass.html",controller:"authController",controllerAs:"authCtrl"}}}),a.state(c.forbiddenState,{url:"/forbidden",views:{mainView:{templateUrl:"src/templates/forbidden.html",controller:"authController",controllerAs:"authCtrl"}}})}]),b.config(["$httpProvider",function(a){a.interceptors.push(["$q","$injector",function(a,b){return{responseError:function(c){var d=b.get("authService");return 401===c.status&&d.goToLogin(),403===c.status&&d.goToForbidden(),a.reject(c)},request:function(a){return a.withCredentials=!0,a},response:function(a){return a}}}]),b.run(["authService","$rootScope",function(a,b){a.userAuthenticated().then(function(a){200===a.status&&a.data&&b.$broadcast("logged-in",a.data)})}])}])}(window.angular),function(a){var b=a.module("authModule");b.controller("authController",["$scope","authService",function(a,b){function c(b,c){var d=["info","danger","warning","success"];d.some(function(a){return c===a})&&a.alerts.push({type:c,msg:b})}a.alerts=[],a.roles=b.getRoles(),b.userAuthenticated().then(function(b){a.currentUser=b.data,""===a.currentUser||a.menuitems||a.setMenu(a.currentUser)}),a.loading=!1,a.$on("logged-in",function(b,c){a.currentUser=c,a.setMenu(a.currentUser)}),a.setMenu=function(b){a.menuitems=[];for(var c in a.roles)if(-1!==b.roles.indexOf(c))for(var d in a.roles[c])-1===a.menuitems.indexOf(a.roles[c][d])&&a.menuitems.push(a.roles[c][d])},a.isAuthenticated=function(){return!!a.currentUser},this.closeAlert=function(b){a.alerts.splice(b,1)},this.showError=function(a){c(a,"danger")},this.showSuccess=function(a){c(a,"success")},this.login=function(c){var d=this;c&&c.userName&&c.password&&(a.loading=!0,b.login(c).then(function(a){},function(a){d.showError(a.data)})["finally"](function(){a.loading=!1}))},a.logout=function(){b.logout().then(function(){a.currentUser=""})},this.registration=function(){b.registration()};var d=this;this.register=function(c){a.loading=!0,b.register(c).then(function(a){d.showSuccess("User registered successfully")},function(a){d.showError(a.data.substring(65))})["finally"](function(){a.loading=!1})},a.isCheckRequired=function(a){return!a},this.goToForgotPass=function(){b.goToForgotPass()},this.forgotPass=function(c){var d=this;c&&(a.loading=!0,b.forgotPass(c).then(function(a){},function(a){d.showError(a.data.substring(66))})["finally"](function(){a.loading=!1}))},a.goToLogin=function(){b.goToLogin()},this.goBack=function(){b.goToBack()},a.goToSuccess=function(){b.goToSuccess()}}])}(window.angular),function(a){var b=a.module("authModule");b.directive("loginButton",[function(){return{scope:{},restrict:"E",templateUrl:"src/templates/button.html",controller:"authController"}}])}(window.angular),function(a){var b=a.module("authModule");b.provider("authService",function(){var b={apiUrl:"api/users/",loginState:"login",logoutRedirectState:"login",registerState:"register",forgotPassState:"forgot",successState:"home",forbiddenState:"forbidden",loginURL:"login",registerURL:"register",logoutURL:"logout",forgotPassURL:"forgot",meURL:"me"},c={};this.setValues=function(c){b=a.extend(b,c)},this.getValues=function(){return b},this.getRoles=function(){return c},this.setRoles=function(a){c=a},this.$get=["$state","$http","$rootScope",function(a,d,e){return{getRoles:function(){return c},login:function(c){return d.post(b.apiUrl+b.loginURL,c).then(function(c){e.$broadcast("logged-in",c.data),a.go(b.successState)})},getConf:function(){return b},logout:function(){return d.get(b.apiUrl+b.logoutURL).then(function(){e.$broadcast("logged-out"),a.go(b.logoutRedirectState)})},register:function(c){return d.post(b.apiUrl+b.registerURL,c).then(function(c){a.go(b.loginState)})},forgotPass:function(c){return d.post(b.apiUrl+b.forgotPassURL,c).then(function(c){a.go(b.loginState)})},registration:function(){a.go(b.registerState)},goToLogin:function(){a.go(b.loginState)},goToForgotPass:function(){a.go(b.forgotPassState)},goToBack:function(){a.go(b.loginState)},goToSuccess:function(){a.go(b.successState)},goToForbidden:function(){a.go(b.forbiddenState)},userAuthenticated:function(){return d.get(b.apiUrl+b.meURL)}}}]})}(window.angular),angular.module("authModule").run(["$templateCache",function(a){"use strict";a.put("src/templates/button.html",'<button id="login-btn" ng-hide="isAuthenticated()" type="button" class="btn btn-default navbar-btn" ng-click="goToLogin()"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> Login</button><div ng-show="isAuthenticated()" class="btn-group"><button id="menu-btn" type="button" class="btn btn-default dropdown-toggle navbar-btn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{currentUser.userName}} <span class="caret"></span></button><ul class="dropdown-menu"><li ng-repeat="menuitem in menuitems"><a ui-sref="{{menuitem.state}}"><span class="glyphicon glyphicon-{{menuitem.icon}}" aria-hidden="true"></span> {{menuitem.label}}</a></li><li><a href ng-click="logout()"><span class="glyphicon glyphicon-log-out" aria-hidden="true"></span> Logout</a></li></ul></div>'),a.put("src/templates/forbidden.html",'<div class="jumbotron"><h1>Oups,Forbidden!!</h1><p>You don\'t have permissions for this resource!!</p><p><a class="btn btn-primary btn-lg" ng-click="goToSuccess()" role="button">Back</a></p></div>'),a.put("src/templates/forgotPass.html",'<div><div class="col-md-5 col-md-offset-4"><div class="col-md-12"><alert ng-repeat="alert in alerts" type="{{alert.type}}" close="authCtrl.closeAlert($index)">{{alert.msg}}</alert><div class="panel panel-default"><div class="panel-heading"><h2 class="panel-title">Password assistance</h2></div><div class="panel-body"><div ng-messages="forgotPassform.email.$error" ng-show="(forgotPassform.$error.required || forgotPassform.email.$invalid) && forgotPassform.email.$touched"><div ng-message="required"><alert type="danger" close="">Please, Fill the required field!</alert></div><div ng-message="email"><alert type="danger" close="">Your email address is invalid!</alert></div></div><p>Enter the email address associated with your account, then click <strong>Send Email</strong>. We\'ll send you a link to a page where you can easily create a new password.</p><form name="forgotPassform" accept-charset="UTF-8" role="form" ng-submit="authCtrl.forgotPass(user)"><div class="form-group" ng-class="{\'has-success\': forgotPassform.email.$valid, \'has-error\': forgotPassform.email.$invalid}"><input class="form-control" required ng-model="user.email" placeholder="Email" name="email" type="email"></div><input class="btn btn-lg btn-success btn-block" type="submit" value="Send Email"></form><button class="btn btn-lg btn-default btn-block" ng-click="authCtrl.goBack()" type="button">Go Back</button><div class="spinner text-center" ng-show="loading"><img src="http://www.lectulandia.com/wp-content/themes/ubook/images/spinner.gif" alt="Loading" style="width:48px;height:48px"></div></div></div></div></div></div>'),a.put("src/templates/login.html",'<div><div class="col-md-5 col-md-offset-4"><alert ng-repeat="alert in alerts" type="{{alert.type}}" close="authCtrl.closeAlert($index)">{{alert.msg}}</alert><div class="col-md-12"><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">Please Login</h3></div><div class="panel-body"><form name="loginform" accept-charset="UTF-8" role="form"><div class="form-group"><input class="form-control" id="username-input" required ng-model="user.userName" placeholder="Username or Email" name="username" type="text"></div><div class="form-group"><div class="text-right"><a align="right" ng-click="authCtrl.goToForgotPass()">Forgot your password?</a></div><input class="form-control" id="password-input" required ng-model="user.password" placeholder="Password" name="password" type="password"></div><div class="checkbox"><label><input id="remember-me-input" name="rememberMe" type="checkbox" ng-model="user.rememberMe" value="false"> Remember Me</label></div><input id="log-in-btn" class="btn btn-lg btn-success btn-block" ng-click="authCtrl.login(user)" type="submit" value="Login"></form><button id="register-btn" class="btn btn-lg btn-default btn-block" ng-click="authCtrl.registration()">Create an account</button><div class="spinner text-center" ng-show="loading"><img src="http://www.lectulandia.com/wp-content/themes/ubook/images/spinner.gif" alt="Loading" style="width:48px;height:48px"></div></div></div></div></div></div>'),a.put("src/templates/register.html",'<div><div class="col-md-5 col-md-offset-4"><alert ng-repeat="alert in alerts" type="{{alert.type}}" close="authCtrl.closeAlert($index)">{{alert.msg}}</alert><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">Please Register</h3></div><div class="panel-body"><div ng-messages="loginform.$error" ng-show="(loginform.$error.required || loginform.email.$invalid || loginform.confirmpassword.$error || loginform.$error.minlength) && loginform.username.$touched"><div ng-message="required"><alert type="danger" close="">Please, Fill the required fields!</alert></div><div ng-message="minlength"><alert type="danger" close="">Your password must be 6 and 10 characters long!</alert></div><div ng-message="email"><alert type="danger" close="">Your email address is invalid!</alert></div><div ng-message="pattern"><alert type="danger" close="">Passwords must be equals !!</alert></div></div><form novalidate name="loginform" accept-charset="UTF-8" role="form" ng-submit="loginform.$valid && authCtrl.register(user)"><fieldset><div class="form-group" ng-class="{\'has-success\': loginform.username.$valid && loginform.name.$dirty, \'has-error\': loginform.name.$invalid && loginform.$submitted }"><input id="username-input" class="form-control" required ng-model="user.userName" placeholder="Username" name="username" type="text"></div><div class="form-group" ng-class="{\'has-success\': loginform.password.$valid && loginform.password.$dirty, \'has-error\': loginform.password.$invalid && loginform.$submitted }"><input id="password-input" class="form-control" minlength="6" required ng-model="user.password" placeholder="Password" name="password" type="password"></div><div class="form-group" ng-class="{\'has-success\': loginform.confirmpassword.$valid && loginform.confirmpassword.$dirty, \'has-error\': loginform.confirmpassword.$invalid && loginform.$submitted }"><input id="comfirm-password-input" class="form-control" minlength="6" required ng-model="user.confirmPassword" ng-pattern="{{user.password}}" placeholder="Confirm Password" name="confirmpassword" type="password"></div><div class="row"><div class="form-group col-xs-6" ng-class="{\'has-success\': loginform.firstname.$valid && loginform.firstname.$dirty, \'has-error\': loginform.firstname.$invalid && loginform.$submitted }"><input id="given-name-input" class="form-control" align="left" required ng-model="user.givenName" placeholder="First name" name="firstname" type="text"></div><div class="form-group col-xs-6" ng-class="{\'has-success\': loginform.middlename.$valid && loginform.middlename.$dirty, \'has-error\': loginform.middlename.$invalid && loginform.$submitted }"><input id="middle-name-input" class="form-control" align="right" ng-model="user.middleName" placeholder="Middle name" name="middlename" type="text"></div></div><div class="form-group" ng-class="{\'has-success\': loginform.lastname.$valid && loginform.lastname.$dirty, \'has-error\': loginform.lastname.$invalid && loginform.$submitted }"><input id="last-name-input" class="form-control" required ng-model="user.surName" placeholder="Last Name" name="lastname" type="text"></div><div class="form-group"><label>Please select your roles:</label><br><div class="row"><div class="col-xs-6" ng-repeat="(key,value) in roles"><p><strong>{{key}}</strong></p><input ng-required="isCheckRequired(user.roles)" type="checkbox" name="roles" checklist-model="user.roles" checklist-value="key" ng-class="{\'has-success\': loginform.roles.$valid && loginform.roles.$dirty, \'has-error\': loginform.roles.$invalid && loginform.$submitted }"></div></div></div><div class="form-group" ng-class="{\'has-success\': loginform.email.$valid && loginform.email.$dirty, \'has-error\': loginform.email.$invalid && loginform.$submitted }"><input id="email-input" class="form-control" required ng-model="user.email" placeholder="email" name="email" type="email"></div></fieldset><input id="register-btn" class="btn btn-lg btn-primary btn-block" type="submit" value="Register"></form><input class="btn btn-lg btn-default btn-block" ng-click="authCtrl.goBack()" type="submit" value="Go Back"><div class="spinner text-center" ng-show="loading"><img src="http://www.lectulandia.com/wp-content/themes/ubook/images/spinner.gif" alt="Loading" style="width:48px;height:48px"></div></div></div></div></div>')}]);