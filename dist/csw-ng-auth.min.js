/*! csw-ng-auth 2016-01-28 */
!function(a){var b=a.module("authModule",["ngCookies","ui.router","checklist-model"]);b.constant("defaultStatus",{status:!1}),b.config(["$stateProvider","authServiceProvider",function(a,b){var c=b.getValues();a.state(c.loginState,{url:c.loginState,templateUrl:"src/templates/login.html",controller:"authController",controllerAs:"authCtrl"}).state(c.registerState,{url:c.registerState,templateUrl:"src/templates/register.html",controller:"authController",controllerAs:"authCtrl"}).state(c.forgotPassState,{url:c.forgotPassState,templateUrl:"src/templates/forgotPass.html",controller:"authController",controllerAs:"authCtrl"}).state(c.forbiddenState,{url:c.forbiddenState,templateUrl:"src/templates/forbidden.html",controller:"authController",controllerAs:"authCtrl"})}]),b.config(["$httpProvider",function(a){a.interceptors.push(["$q","$log","$injector",function(a,b,c){return{responseError:function(d){var e=c.get("authService");return 401===d.status&&(b.debug("error 401",d),e.goToLogin()),403===d.status&&(b.debug("error 403",d),e.goToForbidden()),a.reject(d)},request:function(a){return a.withCredentials=!0,a},response:function(a){return a}}}]),b.run(["authService","$rootScope",function(a,b){a.userAuthenticated().then(function(a){200===a.status&&a.data&&b.$broadcast("logged-in",a.data)})}])}])}(window.angular),function(a){var b=a.module("authModule");b.controller("authController",["$scope","$cookies","authService","defaultStatus","$log",function(a,b,c,d,e){this.errorctrl=d,a.roles=c.getRoles(),c.userAuthenticated().then(function(b){a.currentUser=b.data,""===a.currentUser||a.menuitems||a.setMenu(a.currentUser)}),a.loading=!1,a.$on("logged-in",function(b,c){a.currentUser=c,a.setMenu(a.currentUser)}),a.setMenu=function(b){a.menuitems=[];for(var c in a.roles)if(-1!=b.roles.indexOf(c))for(var d in a.roles[c])a.menuitems.push(a.roles[c][d])},a.isAuthenticated=function(){return!!a.currentUser},this.login=function(b){var d=this;b&&b.userName&&b.password&&(a.loading=!0,c.login(b).then(function(a){},function(a){d.errorctrl={status:!0,type:"danger",msg:":"+a.data},e.error("Error",a)})["finally"](function(){a.loading=!1}))},a.logout=function(){c.logout().then(function(){a.currentUser=""})},a.log=function(a){e.debug(a)},this.close=function(){this.errorctrl=d},this.registration=function(){c.registration()},this.register=function(b){var d=this;b&&b.hasOwnProperty("userName")&&b.hasOwnProperty("password")&&b.hasOwnProperty("confirmPassword")&&b.hasOwnProperty("email")&&b.hasOwnProperty("givenName")&&b.hasOwnProperty("surName")?b.password!==b.confirmPassword?this.errorctrl={status:!0,type:"warning",msg:": Passwords must be equals"}:(a.loading=!0,c.register(b).then(function(a){d.errorctrl={status:!0,type:"success",msg:":  User registered successfully"}},function(a){d.errorctrl={status:!0,type:"danger",msg:": "+a.data.substring(66)}})["finally"](function(){a.loading=!1})):d.errorctrl={status:!0,type:"danger",msg:": You must complete all fields"}},this.goToForgotPass=function(){c.goToForgotPass()},this.forgotPass=function(b){var d=this;b?(a.loading=!0,c.forgotPass(b).then(function(a){},function(a){d.errorctrl={status:!0,type:"danger",msg:":"+a.data.substring(66)}})["finally"](function(){a.loading=!1})):d.errorctrl={status:!0,type:"danger",msg:":You must to enter an email address"}},a.goToLogin=function(){c.goToLogin()},this.goBack=function(){c.goToBack()},a.goToSuccess=function(){c.goToSuccess()}}])}(window.angular),function(a){var b=a.module("authModule");b.directive("loginButton",[function(){return{scope:{},restrict:"E",templateUrl:"src/templates/button.html",controller:"authController"}}])}(window.angular),function(a){var b=a.module("authModule");b.provider("authService",function(){var b={apiUrl:"api/users/",loginState:"login",logoutRedirectState:"login",registerState:"register",forgotPassState:"forgot",successState:"home",forbiddenState:"forbidden",loginURL:"login",registerURL:"register",logoutURL:"logout",forgotPassURL:"forgot",meURL:"me"},c={};this.setValues=function(c){b=a.extend(b,c)},this.getValues=function(){return b},this.getRoles=function(){return c},this.setRoles=function(a){c=a},this.$get=["$cookies","$state","$http","$rootScope","$log",function(a,d,e,f,g){return{getRoles:function(){return c},login:function(a){return e.post(b.apiUrl+b.loginURL,a).then(function(a){f.$broadcast("logged-in",a.data),g.debug("user",a.data),d.go(b.successState)})},getConf:function(){return b},logout:function(){return e.get(b.apiUrl+b.logoutURL).then(function(){d.go(b.logoutRedirectState)})},register:function(a){return e.post(b.apiUrl+b.registerURL,a).then(function(a){d.go(b.loginState)})},forgotPass:function(a){return e.post(b.apiUrl+b.forgotPassURL,a).then(function(a){d.go(b.loginState)})},registration:function(){d.go(b.registerState)},goToLogin:function(){d.go(b.loginState)},goToForgotPass:function(){d.go(b.forgotPassState)},goToBack:function(){d.go(b.loginState)},goToSuccess:function(){d.go(b.successState)},goToForbidden:function(){d.go(b.forbiddenState)},userAuthenticated:function(){return e.get(b.apiUrl+b.meURL)}}}]})}(window.angular),angular.module("authModule").run(["$templateCache",function(a){"use strict";a.put("src/templates/button.html",'<button ng-hide="isAuthenticated()" type="button" class="btn btn-default navbar-btn" ng-click="goToLogin()"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> Login</button><div ng-show="isAuthenticated()" class="btn-group"><button type="button" class="btn btn-default dropdown-toggle navbar-btn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{currentUser.userName}} <span class="caret"></span></button><ul class="dropdown-menu"><li ng-repeat="menuitem in menuitems"><a ui-sref="{{menuitem.state}}"><span class="glyphicon glyphicon-{{menuitem.icon}}" aria-hidden="true"></span> {{menuitem.label}}</a></li><li><a href ng-click="logout()"><span class="glyphicon glyphicon-log-out" aria-hidden="true"></span> Logout</a></li></ul></div>'),a.put("src/templates/forbidden.html",'<div class="jumbotron"><h1>Oups,Forbidden!!</h1><p>You don\'t have permissions for this resource!!</p><p><a class="btn btn-primary btn-lg" ng-click="goToSuccess()" role="button">Back</a></p></div>'),a.put("src/templates/forgotPass.html",'<div><div class="col-md-5 col-md-offset-4"><div class="col-md-12" ng-show="authCtrl.errorctrl.status" ng-message="show"><div class="alert alert-{{authCtrl.errorctrl.type}}" role="alert"><button type="button" class="close" ng-click="authCtrl.close()" aria-label="Close"><span aria-hidden="true">&times;</span></button> <strong>{{authCtrl.errorctrl.type| uppercase}}</strong> {{authCtrl.errorctrl.msg}}</div></div><div class="col-md-12"><div class="panel panel-default"><div class="panel-heading"><h2 class="panel-title">Password assistance</h2></div><div class="panel-body"><p>Enter the email address associated with your account, then click <strong>Send Email</strong>. We\'ll send you a link to a page where you can easily create a new password.</p><form name="forgotPassform" accept-charset="UTF-8" role="form"><div class="form-group"><input class="form-control" required ng-model="user.email" placeholder="Email" name="email" type="email"></div><input class="btn btn-lg btn-success btn-block" ng-click="authCtrl.forgotPass(user)" type="submit" value="Send Email"> <input class="btn btn-lg btn-default btn-block" ng-click="authCtrl.goBack()" type="submit" value="Go Back"></form><div class="spinner text-center" ng-show="loading"><img src="http://www.lectulandia.com/wp-content/themes/ubook/images/spinner.gif" alt="Loading" style="width:48px;height:48px"></div></div></div></div></div></div>'),a.put("src/templates/login.html",'<div><div class="col-md-5 col-md-offset-4"><div class="col-md-12" ng-show="authCtrl.errorctrl.status" ng-message="show"><div class="alert alert-{{authCtrl.errorctrl.type}}" role="alert"><button type="button" class="close" ng-click="authCtrl.close()" aria-label="Close"><span aria-hidden="true">&times;</span></button> <strong>{{authCtrl.errorctrl.type| uppercase}}</strong> {{authCtrl.errorctrl.msg}}</div></div><div class="col-md-12"><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">Please Login</h3></div><div class="panel-body"><form name="loginform" accept-charset="UTF-8" role="form"><div class="form-group"><input class="form-control" required ng-model="user.userName" placeholder="Username or Email" name="username" type="text"></div><div class="form-group"><div class="text-right"><a align="right" ng-click="authCtrl.goToForgotPass()">Forgot your password?</a></div><input class="form-control" required ng-model="user.password" placeholder="Password" name="password" type="password"></div><div class="checkbox"><label><input name="rememberMe" type="checkbox" ng-model="user.rememberMe" value="false"> Remember Me</label></div><input class="btn btn-lg btn-success btn-block" ng-click="authCtrl.login(user)" type="submit" value="Login"></form><button class="btn btn-lg btn-default btn-block" ng-click="authCtrl.registration()">Create an account</button><div class="spinner text-center" ng-show="loading"><img src="http://www.lectulandia.com/wp-content/themes/ubook/images/spinner.gif" alt="Loading" style="width:48px;height:48px"></div></div></div></div></div></div>'),a.put("src/templates/register.html",'<div><div class="col-md-5 col-md-offset-4"><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">Please Register</h3><div style="padding-top: 30px" class="col-md-12" ng-show="authCtrl.errorctrl.status" ng-message="show"><div class="alert alert-{{authCtrl.errorctrl.type}}" role="alert"><button type="button" class="close" ng-click="authCtrl.close()" aria-label="Close"><span aria-hidden="true">&times;</span></button> <strong>{{authCtrl.errorctrl.type| uppercase}}</strong> {{authCtrl.errorctrl.msg}}</div></div></div><div class="panel-body"><form name="loginform" accept-charset="UTF-8" role="form"><div class="form-group"><input class="form-control" required ng-model="user.userName" placeholder="Username" name="username" type="text"></div><div class="form-group"><input class="form-control" required ng-model="user.password" placeholder="Password" name="password" type="password"></div><div class="form-group"><input class="form-control" required ng-model="user.confirmPassword" placeholder="Confirm Password" name="confirmpassword" type="password"></div><div class="row"><div class="form-group col-xs-6"><input class="form-control" align="left" required ng-model="user.givenName" placeholder="First name" name="firstname" type="text"></div><div class="form-group col-xs-6"><input class="form-control" align="right" ng-model="user.middleName" placeholder="Middle name" name="middlename" type="text"></div></div><div class="form-group"><input class="form-control" required ng-model="user.surName" placeholder="Last Name" name="lastname" type="text"></div><div class="form-group"><label>Please select your roles:</label><br><div class="row"><div class="col-xs-6" ng-repeat="(key,value) in roles"><p><strong>{{key}}</strong></p><input type="checkbox" checklist-model="user.roles" checklist-value="key"></div></div></div><div class="form-group"><input class="form-control" required ng-model="user.email" placeholder="email" name="email" type="email"></div><input class="btn btn-lg btn-primary btn-block" ng-click="authCtrl.register(user)" type="submit" value="Register"> <input class="btn btn-lg btn-default btn-block" ng-click="authCtrl.goBack()" type="submit" value="Go Back"></form><div class="spinner text-center" ng-show="loading"><img src="http://www.lectulandia.com/wp-content/themes/ubook/images/spinner.gif" alt="Loading" style="width:48px;height:48px"></div></div></div></div></div>')}]);